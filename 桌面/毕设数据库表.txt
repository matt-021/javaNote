CREATE TABLE user(
id int primary key auto_increment,
name varchar(20),
password varchar(20),
age varchar(5),                    //一个问题 初期设计不严谨  把性别名设置成age  
address varchar(50),
email varchar(20),
telephone varchar(20)
)ENGINE=INNODB DEFAULT CHARSET=UTF8;
对 user 表 加一个字段   n  表示  终端数量
alter table add n int；

insert into user(name,password,age,address,email,telephone)values
('admin','123','男','漳州','550369801@qq.com','18046188340'),
('lin','123','人妖','泰国','1234567@qq.com','1235261841'),
('fuqi','123','男','厦门','545459801@qq.com','18054545340'),
('hahhaa','123','女','北京','99088801@qq.com','180461454540'),
('美女','123','男','深圳','5453801@qq.com','18044778340'),
('邱淑贞','123','女','杭州','35038801@qq.com','1804621188340');




lin1 此表是终端实时湿度表
create table lin1
(

   id int primary key auto_increment,
   temperature double,
   humidity double,
   time timestamp
);
insert into lin1 values(21.3,12),(22.4,22),(23.3,30),(24.3,43),(25.3,50),(26.3,60),(27.3,70),(28.3,80);

lin1和user是一对多的关系  固加外键并加级联
                                                               1. 级联更新：ON UPDATE CASCADE 
				2. 级联删除：ON DELETE CASCADE 

alter table lin1 add uid int;
 ALTER TABLE lin1 ADD CONSTRAINT uid
FOREIGN KEY (uid) REFERENCES user(id) ON UPDATE CASCADE ON DELETE CASCADE  ;

CREATE TABLE `lin1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `temperature` double DEFAULT NULL,
  `humidity` double DEFAULT NULL,
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `uid` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `uid` (`uid`),
  CONSTRAINT `uid` FOREIGN KEY (`uid`) REFERENCES `user` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=6091 DEFAULT CHARSET=utf8

删除uid一样的最后一条数据  出现的问题mysql 出现You can't specify target table for update in FROM clause错误的解决方法
解决方法：select的结果再通过一个中间表select多一次，就可以避免这个错误
delete from lin1 where id=(select i from(select max(id) i from lin1 where uid=19)as a);


lin1终端实时温湿度表（修改)
CREATE TABLE `lin1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `temperature` double DEFAULT NULL,
  `humidity` double DEFAULT NULL,
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `uid` int(11) DEFAULT NULL,
  `user_set_tempmax` double DEFAULT NULL,
  `user_set_tempmin` double DEFAULT NULL,
  `user_set_humimin` double DEFAULT NULL,
  `user_set_humimax` double DEFAULT NULL,
  `fan_flag` varchar(10) DEFAULT NULL,
  `device_comment` varchar(15) DEFAULT NULL,
  `user_set_info` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `uid` (`uid`),
  CONSTRAINT `uid` FOREIGN KEY (`uid`) REFERENCES `user` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=148 DEFAULT CHARSET=utf8



终端1的表
create table product1(
 
   pid int default 30,
   temperature double,
   humidity double,
   historytime varchar(20)
)ENGINE=INNODB DEFAULT CHARSET=UTF8;


终端的历史记录表   表名的格式product_uid_id;  
CREATE TABLE `product_51_138` (
  `pid` int(11) DEFAULT '30',
  `temperature` double DEFAULT NULL,
  `humidity` double DEFAULT NULL,
  `historytime` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8



管理员的表
CREATE TABLE `admin` (
  `id` int(5) NOT NULL AUTO_INCREMENT,
  `name` varchar(10) NOT NULL,
  `password` varchar(20) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8


管理员和用户的中间表

create table admin_user(
  id int(5) primary key auto_increment,
  user_id int(11) NOT NULL ,
  admin_id int(11) NOT NULL,
  KEY user_id_alias (user_id),
  KEY admin_id_alias (admin_id),
  CONSTRAINT user_id_alias FOREIGN KEY (user_id) REFERENCES user (id),
  CONSTRAINT admin_id_alias FOREIGN KEY (admin_id) REFERENCES admin (id)
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


由于之前表设计不合理，现把所有终端的历史记录表汇整成一个表，把所有终端历史记录存在其中，
create table product_history
(

   id int primary key auto_increment,
   temperature double,
   humidity double,
   time timestamp,
   product_name varchar(10) //uid_pid的格式区别终端
);